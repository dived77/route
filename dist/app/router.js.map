{"version":3,"sources":["../../app/router.js"],"names":["module","exports","router","app","controller","config","middleware","site","sign","user","topic","rss","search","page","reply","message","userRequired","adminRequired","createTopicLimit","createUserLimit","create_user_per_ip","post","get","index","sitemap","appDownload","allow_sign_up","showSignup","signup","redirect","localStrategy","passport","authenticate","showLogin","all","signout","activeAccount","mount","showSearchPass","updateSearchPass","resetPass","updatePass","showSetting","setting","listStars","top100","listCollectedTopics","listTopics","listReplies","toggleStar","block","deleteAll","create","top","good","showEdit","lock","delete","put","update","collect","de_collect","add","up","upload","about","faq","getstart","robots","api"],"mappings":"AAAA;;AAEA;;;;AAGAA,OAAOC,OAAP,GAAiB,eAAO;AAAA,QACZC,MADY,GAC+BC,GAD/B,CACZD,MADY;AAAA,QACJE,UADI,GAC+BD,GAD/B,CACJC,UADI;AAAA,QACQC,MADR,GAC+BF,GAD/B,CACQE,MADR;AAAA,QACgBC,UADhB,GAC+BH,GAD/B,CACgBG,UADhB;AAAA,QAIhBC,IAJgB,GAMhBH,UANgB,CAIhBG,IAJgB;AAAA,QAIVC,IAJU,GAMhBJ,UANgB,CAIVI,IAJU;AAAA,QAIJC,IAJI,GAMhBL,UANgB,CAIJK,IAJI;AAAA,QAIEC,KAJF,GAMhBN,UANgB,CAIEM,KAJF;AAAA,QAISC,GAJT,GAMhBP,UANgB,CAISO,GAJT;AAAA,QAKhBC,MALgB,GAMhBR,UANgB,CAKhBQ,MALgB;AAAA,QAKRC,IALQ,GAMhBT,UANgB,CAKRS,IALQ;AAAA,QAKFC,KALE,GAMhBV,UANgB,CAKFU,KALE;AAAA,QAKKC,OALL,GAMhBX,UANgB,CAKKW,OALL;;;AAQpB,QAAMC,eAAeV,WAAWU,YAAX,EAArB;AACA,QAAMC,gBAAgBX,WAAWW,aAAX,EAAtB;AACA,QAAMC,mBAAmBZ,WAAWY,gBAAX,CAA4Bb,OAAOK,KAAnC,CAAzB;AACA,QAAMS,kBAAkBb,WAAWa,eAAX,CAA2Bd,OAAOe,kBAAlC,CAAxB;;AAGAlB,WAAOmB,IAAP,CAAY,mBAAZ;AACA;AACAnB,WAAOoB,GAAP,CAAW,GAAX,EAAgBf,KAAKgB,KAArB;AACA;AACArB,WAAOoB,GAAP,CAAW,cAAX,EAA2Bf,KAAKiB,OAAhC;AACA;AACAtB,WAAOoB,GAAP,CAAW,eAAX,EAA4Bf,KAAKkB,WAAjC;;AAEA;AACA,QAAIpB,OAAOqB,aAAX,EAA0B;AACtB;AACAxB,eAAOoB,GAAP,CAAW,SAAX,EAAsBd,KAAKmB,UAA3B;AACA;AACAzB,eAAOmB,IAAP,CAAY,SAAZ,EAAuBF,eAAvB,EAAwCX,KAAKoB,MAA7C;AACH,KALD,MAKO;AACH;AACA1B,eAAO2B,QAAP,CAAgB,SAAhB,EAA2B,cAA3B;AACH;;AAED,QAAMC,gBAAgB3B,IAAI4B,QAAJ,CAAaC,YAAb,CAA0B,OAA1B,EAAmC;AACrD,2BAAmB,GADkC;AAErD,2BAAmB;AAFkC,KAAnC,CAAtB;;AAKA9B,WAAOoB,GAAP,CAAW,SAAX,EAAsBd,KAAKyB,SAA3B,EAtCoB,CAsCmB;AACvC/B,WAAOmB,IAAP,CAAY,iBAAZ,EAA+BS,aAA/B;AACA5B,WAAOgC,GAAP,CAAW,UAAX,EAAuB1B,KAAK2B,OAA5B,EAxCoB,CAwCkB;AACtCjC,WAAOoB,GAAP,CAAW,iBAAX,EAA8Bd,KAAK4B,aAAnC,EAzCoB,CAyC+B;;AAEnD;AACAjC,QAAI4B,QAAJ,CAAaM,KAAb,CAAmB,QAAnB;;AAEAnC,WAAOoB,GAAP,CAAW,cAAX,EAA2Bd,KAAK8B,cAAhC,EA9CoB,CA8C6B;AACjDpC,WAAOmB,IAAP,CAAY,cAAZ,EAA4Bb,KAAK+B,gBAAjC,EA/CoB,CA+CgC;AACpDrC,WAAOoB,GAAP,CAAW,aAAX,EAA0Bd,KAAKgC,SAA/B,EAhDoB,CAgDuB;AAC3CtC,WAAOmB,IAAP,CAAY,aAAZ,EAA2Bb,KAAKiC,UAAhC,EAjDoB,CAiDyB;;AAE7C;AACAvC,WAAOoB,GAAP,CAAW,aAAX,EAA0Bb,KAAKc,KAA/B,EApDoB,CAoDmB;AACvCrB,WAAOoB,GAAP,CAAW,UAAX,EAAuBN,YAAvB,EAAqCP,KAAKiC,WAA1C,EArDoB,CAqDoC;AACxDxC,WAAOmB,IAAP,CAAY,UAAZ,EAAwBL,YAAxB,EAAsCP,KAAKkC,OAA3C,EAtDoB,CAsDiC;AACrDzC,WAAOoB,GAAP,CAAW,QAAX,EAAqBb,KAAKmC,SAA1B,EAvDoB,CAuDkB;AACtC1C,WAAOoB,GAAP,CAAW,eAAX,EAA4Bb,KAAKoC,MAAjC,EAxDoB,CAwDsB;AAC1C3C,WAAOoB,GAAP,CAAW,yBAAX,EAAsCb,KAAKqC,mBAA3C,EAzDoB,CAyD6C;AACjE5C,WAAOoB,GAAP,CAAW,oBAAX,EAAiCb,KAAKsC,UAAtC,EA1DoB,CA0D+B;AACnD7C,WAAOoB,GAAP,CAAW,qBAAX,EAAkCb,KAAKuC,WAAvC,EA3DoB,CA2DiC;AACrD9C,WAAOmB,IAAP,CAAY,gBAAZ,EAA8BJ,aAA9B,EAA6CR,KAAKwC,UAAlD,EA5DoB,CA4D2C;AAC/D/C,WAAOmB,IAAP,CAAY,mBAAZ,EAAiCJ,aAAjC,EAAgDR,KAAKwC,UAArD,EA7DoB,CA6D8C;AAClE/C,WAAOmB,IAAP,CAAY,mBAAZ,EAAiCJ,aAAjC,EAAgDR,KAAKyC,KAArD,EA9DoB,CA8DyC;AAC7DhD,WAAOmB,IAAP,CAAY,wBAAZ,EAAsCJ,aAAtC,EAAqDR,KAAK0C,SAA1D,EA/DoB,CA+DkD;;AAEtE;AACAjD,WAAOoB,GAAP,CAAW,cAAX,EAA2BN,YAA3B,EAAyCD,QAAQQ,KAAjD,EAlEoB,CAkEqC;;AAEzD;;AAEA;AACArB,WAAOoB,GAAP,CAAW,eAAX,EAA4BN,YAA5B,EAA0CN,MAAM0C,MAAhD;;AAEAlD,WAAOoB,GAAP,CAAW,aAAX,EAA0BZ,MAAMa,KAAhC,EAzEoB,CAyEoB;AACxCrB,WAAOmB,IAAP,CAAY,iBAAZ,EAA+BJ,aAA/B,EAA8CP,MAAM2C,GAApD,EA1EoB,CA0EsC;AAC1DnD,WAAOmB,IAAP,CAAY,kBAAZ,EAAgCJ,aAAhC,EAA+CP,MAAM4C,IAArD,EA3EoB,CA2EwC;AAC5DpD,WAAOoB,GAAP,CAAW,kBAAX,EAA+BN,YAA/B,EAA6CN,MAAM6C,QAAnD,EA5EoB,CA4E0C;AAC9DrD,WAAOmB,IAAP,CAAY,kBAAZ,EAAgCJ,aAAhC,EAA+CP,MAAM8C,IAArD,EA7EoB,CA6EwC;;AAE5DtD,WAAOmB,IAAP,CAAY,oBAAZ,EAAkCL,YAAlC,EAAgDN,MAAM+C,MAAtD;;AAEA;AACAvD,WAAOmB,IAAP,CAAY,eAAZ,EAA6BL,YAA7B,EAA2CE,gBAA3C,EAA6DR,MAAMgD,GAAnE;;AAEAxD,WAAOmB,IAAP,CAAY,kBAAZ,EAAgCL,YAAhC,EAA8CN,MAAMiD,MAApD;AACAzD,WAAOmB,IAAP,CAAY,gBAAZ,EAA8BL,YAA9B,EAA4CN,MAAMkD,OAAlD,EArFoB,CAqFwC;AAC5D1D,WAAOmB,IAAP,CAAY,mBAAZ,EAAiCL,YAAjC,EAA+CN,MAAMmD,UAArD,EAtFoB,CAsF8C;;AAElE;AACA3D,WAAOmB,IAAP,CAAY,kBAAZ,EAAgCL,YAAhC;AACI;AACAF,UAAMgD,GAFV,EAzFoB,CA2FJ;AAChB5D,WAAOoB,GAAP,CAAW,uBAAX,EAAoCN,YAApC,EAAkDF,MAAMyC,QAAxD,EA5FoB,CA4F+C;AACnErD,WAAOmB,IAAP,CAAY,uBAAZ,EAAqCL,YAArC,EAAmDF,MAAM6C,MAAzD,EA7FoB,CA6F8C;AAClEzD,WAAOmB,IAAP,CAAY,yBAAZ,EAAuCL,YAAvC,EAAqDF,MAAM2C,MAA3D,EA9FoB,CA8FgD;AACpEvD,WAAOmB,IAAP,CAAY,qBAAZ,EAAmCL,YAAnC,EAAiDF,MAAMiD,EAAvD,EA/FoB,CA+FwC;AAC5D7D,WAAOmB,IAAP,CAAY,SAAZ,EAAuBL,YAAvB,EAAqCN,MAAMsD,MAA3C,EAhGoB,CAgGgC;AACpD;AACA9D,WAAOoB,GAAP,CAAW,QAAX,EAAqBT,KAAKoD,KAA1B;AACA/D,WAAOoB,GAAP,CAAW,MAAX,EAAmBT,KAAKqD,GAAxB;AACAhE,WAAOoB,GAAP,CAAW,WAAX,EAAwBT,KAAKsD,QAA7B;AACAjE,WAAOoB,GAAP,CAAW,aAAX,EAA0BT,KAAKuD,MAA/B;AACAlE,WAAOoB,GAAP,CAAW,MAAX,EAAmBT,KAAKwD,GAAxB;;AAEA;AACAnE,WAAOoB,GAAP,CAAW,MAAX,EAAmBX,IAAIY,KAAvB;;AAEArB,WAAOoB,GAAP,CAAW,SAAX,EAAsBV,OAAOW,KAA7B;AACH,CA5GD","file":"router.js","sourcesContent":["'use strict';\n\n/**\n * @param {Egg.Application} app - egg application\n */\nmodule.exports = app => {\n    const { router, controller, config, middleware } = app;\n\n    const {\n        site, sign, user, topic, rss,\n        search, page, reply, message,\n    } = controller;\n\n    const userRequired = middleware.userRequired();\n    const adminRequired = middleware.adminRequired();\n    const createTopicLimit = middleware.createTopicLimit(config.topic);\n    const createUserLimit = middleware.createUserLimit(config.create_user_per_ip);\n\n\n    router.post('/account/register')\n    // home page\n    router.get('/', site.index);\n    // sitemap\n    router.get('/sitemap.xml', site.sitemap);\n    // mobile app download\n    router.get('/app/download', site.appDownload);\n\n    // sign controller\n    if (config.allow_sign_up) {\n        // 跳转到注册页面\n        router.get('/signup', sign.showSignup);\n        // 提交注册信息\n        router.post('/signup', createUserLimit, sign.signup);\n    } else {\n        // 进行github验证\n        router.redirect('/singup', '/auth/github');\n    }\n\n    const localStrategy = app.passport.authenticate('local', {\n        'successRedirect': '/',\n        'failureRedirect': '/signin',\n    });\n\n    router.get('/signin', sign.showLogin); // 进入登录页面\n    router.post('/passport/local', localStrategy);\n    router.all('/signout', sign.signout); // 登出\n    router.get('/active_account', sign.activeAccount); // 帐号激活\n\n    // github oauth\n    app.passport.mount('github');\n\n    router.get('/search_pass', sign.showSearchPass); // 找回密码页面\n    router.post('/search_pass', sign.updateSearchPass); // 更新密码\n    router.get('/reset_pass', sign.resetPass); // 进入重置密码页面\n    router.post('/reset_pass', sign.updatePass); // 更新密码\n\n    // user controller\n    router.get('/user/:name', user.index); // 用户个人主页\n    router.get('/setting', userRequired, user.showSetting); // 用户个人设置页\n    router.post('/setting', userRequired, user.setting); // 提交个人信息设置\n    router.get('/stars', user.listStars); // 显示所有达人列表页\n    router.get('/users/top100', user.top100); // 显示积分前一百用户页\n    router.get('/user/:name/collections', user.listCollectedTopics); // 用户收藏的所有话题页\n    router.get('/user/:name/topics', user.listTopics); // 用户发布的所有话题页\n    router.get('/user/:name/replies', user.listReplies); // 用户参与的所有回复页\n    router.post('/user/set_star', adminRequired, user.toggleStar); // 把某用户设为达人\n    router.post('/user/cancel_star', adminRequired, user.toggleStar); // 取消某用户的达人身份\n    router.post('/user/:name/block', adminRequired, user.block); // 禁言某用户\n    router.post('/user/:name/delete_all', adminRequired, user.deleteAll); // 删除某用户所有发言\n\n    // message controler\n    router.get('/my/messages', userRequired, message.index); // 用户个人的所有消息页\n\n    // topic\n\n    // 新建文章界面\n    router.get('/topic/create', userRequired, topic.create);\n\n    router.get('/topic/:tid', topic.index); // 显示某个话题\n    router.post('/topic/:tid/top', adminRequired, topic.top); // 将某话题置顶\n    router.post('/topic/:tid/good', adminRequired, topic.good); // 将某话题加精\n    router.get('/topic/:tid/edit', userRequired, topic.showEdit); // 编辑某话题\n    router.post('/topic/:tid/lock', adminRequired, topic.lock); // 锁定主题，不能再回复\n\n    router.post('/topic/:tid/delete', userRequired, topic.delete);\n\n    // 保存新建的文章\n    router.post('/topic/create', userRequired, createTopicLimit, topic.put);\n\n    router.post('/topic/:tid/edit', userRequired, topic.update);\n    router.post('/topic/collect', userRequired, topic.collect); // 关注某话题\n    router.post('/topic/de_collect', userRequired, topic.de_collect); // 取消关注某话题\n\n    // reply controller\n    router.post('/:topic_id/reply', userRequired,\n        // limit.peruserperday('create_reply', config.create_reply_per_day, { showJson: false }),\n        reply.add); // 提交一级回复\n    router.get('/reply/:reply_id/edit', userRequired, reply.showEdit); // 修改自己的评论页\n    router.post('/reply/:reply_id/edit', userRequired, reply.update); // 修改某评论\n    router.post('/reply/:reply_id/delete', userRequired, reply.delete); // 删除某评论\n    router.post('/reply/:reply_id/up', userRequired, reply.up); // 为评论点赞\n    router.post('/upload', userRequired, topic.upload); // 上传图片\n    // static page\n    router.get('/about', page.about);\n    router.get('/faq', page.faq);\n    router.get('/getstart', page.getstart);\n    router.get('/robots.txt', page.robots);\n    router.get('/api', page.api);\n\n    // rss\n    router.get('/rss', rss.index);\n\n    router.get('/search', search.index);\n};\n"]}